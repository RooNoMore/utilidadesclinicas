<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epicrisis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        textarea{height:120px;}
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <h1 class="mb-4">Epicrisis</h1>
        <div class="mb-3">
            <label class="form-label">Usuario:
                <input type="text" id="usuario" class="form-control" />
            </label>
        </div>
        <div class="mb-3">
            <label class="form-label">Indicaciones generales:</label>
            <textarea id="indicaciones_generales" class="form-control"></textarea>
            <div class="mt-2 d-flex gap-2">
                <select id="indicaciones_generales_templates" class="form-select"></select>
                <button id="apply_template" class="btn btn-secondary">Aplicar</button>
                <button id="save_template" class="btn btn-outline-primary">Guardar plantilla</button>
            </div>
        </div>
    </div>
<script>
function loadTemplates() {
    const user = document.getElementById('usuario').value.trim();
    const select = document.getElementById('indicaciones_generales_templates');
    const arr = JSON.parse(localStorage.getItem('genIndicTemplates_' + user) || '[]');
    select.innerHTML = '<option value="">- Plantillas -</option>';
    arr.forEach((t,i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = t.slice(0,30).replace(/\n/g,' ') + (t.length>30?'...':'');
        select.appendChild(opt);
    });
}

document.getElementById('usuario').addEventListener('input', loadTemplates);

document.getElementById('save_template').addEventListener('click', () => {
    const user = document.getElementById('usuario').value.trim();
    if(!user) { alert('Ingrese usuario'); return; }
    const text = document.getElementById('indicaciones_generales').value;
    const key = 'genIndicTemplates_' + user;
    const arr = JSON.parse(localStorage.getItem(key) || '[]');
    arr.push(text);
    localStorage.setItem(key, JSON.stringify(arr));
    loadTemplates();
});

document.getElementById('apply_template').addEventListener('click', () => {
    const user = document.getElementById('usuario').value.trim();
    const idx = document.getElementById('indicaciones_generales_templates').value;
    if(idx === '') return;
    const arr = JSON.parse(localStorage.getItem('genIndicTemplates_' + user) || '[]');
    document.getElementById('indicaciones_generales').value = arr[idx] || '';
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
