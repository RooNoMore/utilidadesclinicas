<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de documentos médicos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-light">
<div class="container py-5">
    <h1 class="mb-4">Generador de documentos médicos</h1>
    <div class="mb-3">
        <label for="tipoDocumento" class="form-label">Tipo de documento</label>
        <select id="tipoDocumento" class="form-select">
            <option value="certificado">Certificado médico para colegio</option>
            <option value="salud">Certificado de salud compatible</option>
            <option value="laboratorio">Solicitud de examen de laboratorio</option>
            <option value="receta">Receta médica</option>
            <option value="imagenologia">Solicitud de exámenes imagenológicos y/o procedimientos</option>
        </select>
    </div>

    <form id="formCertificado" class="d-none">
        <div class="mb-3">
            <label class="form-label">Nombre del paciente</label>
            <input type="text" id="certNombre" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">RUT del paciente</label>
            <input type="text" id="certRut" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Diagnóstico</label>
            <input type="text" id="certDiag" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Fecha inicio del reposo</label>
            <input type="date" id="certInicio" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Fecha fin del reposo</label>
            <input type="date" id="certFin" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Establecimiento</label>
            <input type="text" id="certEst" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Nombre del médico</label>
            <input type="text" id="certMedico" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">RUT del médico</label>
            <input type="text" id="certMedRut" class="form-control">
        </div>
    </form>

    <form id="formImagenologia" class="d-none">
        <div class="mb-3">
            <label class="form-label">Nombre del paciente</label>
            <input type="text" id="imgNombre" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">RUT</label>
            <input type="text" id="imgRut" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Edad</label>
            <input type="number" id="imgEdad" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Diagnóstico</label>
            <input type="text" id="imgDiag" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Examen solicitado</label>
            <select id="imgExamen" class="form-select">
                <option>Endoscopia digestiva alta</option>
                <option>Colonoscopia</option>
                <option>Tomografía computada de tórax</option>
                <option>Tomografía computada de abdomen</option>
                <option>Radiografía de tórax</option>
                <option>Radiografía de abdomen</option>
                <option>Ecografía abdominal</option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">Fecha</label>
            <input type="date" id="imgFecha" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Nombre del médico</label>
            <input type="text" id="imgMedico" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">RUT del médico</label>
            <input type="text" id="imgMedRut" class="form-control">
        </div>
    </form>

    <button id="generar" class="btn btn-primary">Generar PDF</button>
</div>

<script>
const { jsPDF } = window.jspdf;

function mostrarFormulario(tipo) {
    document.getElementById('formCertificado').classList.toggle('d-none', tipo !== 'certificado');
    document.getElementById('formImagenologia').classList.toggle('d-none', tipo !== 'imagenologia');
}

function fechaActual() {
    const meses = ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];
    const hoy = new Date();
    return `${hoy.getDate().toString().padStart(2,'0')} de ${meses[hoy.getMonth()]} del ${hoy.getFullYear()}`;
}

function generarCertificado() {
    const doc = new jsPDF();
    const margen = 25;
    doc.text(fechaActual(), 210 - margen, margen, { align: 'right' });
    doc.setFontSize(14);
    doc.text('CERTIFICADO MEDICO', 105, margen + 10, { align: 'center' });
    doc.setFontSize(12);
    const nombre = document.getElementById('certNombre').value;
    const rut = document.getElementById('certRut').value;
    const diag = document.getElementById('certDiag').value;
    const inicio = document.getElementById('certInicio').value;
    const fin = document.getElementById('certFin').value;
    const est = document.getElementById('certEst').value;
    const medico = document.getElementById('certMedico').value;
    const medRut = document.getElementById('certMedRut').value;
    const contenido = `
        <div style="font-size:12px; line-height:1.6;">
            <p style="text-align: justify;">
                Certifico que el paciente <b>${nombre}</b> de RUT <b>${rut}</b> fue evaluado y presenta diagnóstico de <b>${diag}</b>, y deberá guardar reposo entre el <b>${inicio}</b> y el <b>${fin}</b>. Extiendo este certificado para ser presentado en <b>${est}</b>.
            </p>
            <p style="margin-top: 20px;">Atentamente.</p>
            <div style="margin-top: 40px; text-align: center;">
                <hr>
                <p>${medico}<br>${medRut}</p>
            </div>
        </div>`;
    doc.html(contenido, {
        x: margen,
        y: margen + 20,
        width: 160,
        callback: function (doc) {
            doc.save('certificado_medico.pdf');
        }
    });
}

function generarImagenologia() {
    const doc = new jsPDF();
    doc.setFontSize(14);
    doc.text('SOLICITUD DE EXAMENES IMAGENOLOGICOS Y/O PROCEDIMIENTOS', 105, 20, { align: 'center' });
    const nombre = document.getElementById('imgNombre').value;
    const rut = document.getElementById('imgRut').value;
    const edad = document.getElementById('imgEdad').value;
    const diag = document.getElementById('imgDiag').value;
    const examen = document.getElementById('imgExamen').value;
    const fecha = document.getElementById('imgFecha').value;
    const medico = document.getElementById('imgMedico').value;
    const medRut = document.getElementById('imgMedRut').value;
    doc.autoTable({
        startY: 30,
        head: [['Nombre','RUT','Edad','Diagnóstico','Examen','Fecha','Médico','RUT Médico']],
        body: [[nombre, rut, edad, diag, examen, fecha, medico, medRut]],
    });
    doc.text('Firma', 15, doc.lastAutoTable.finalY + 20);
    doc.save('solicitud_imagenes.pdf');
}

document.getElementById('tipoDocumento').addEventListener('change', function() {
    mostrarFormulario(this.value);
});

mostrarFormulario(document.getElementById('tipoDocumento').value);

document.getElementById('generar').addEventListener('click', () => {
    const tipo = document.getElementById('tipoDocumento').value;
    if (tipo === 'certificado') {
        generarCertificado();
    } else if (tipo === 'imagenologia') {
        generarImagenologia();
    } else {
        alert('Tipo de documento no implementado');
    }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
